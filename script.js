const ROADMAP_DATA = {
    january: {
        title: "January — Foundation & Focus",
        days: 31,
        tasks: [
            "Logic & Focus — Solve 1 easy algorithm (HackerRank Warmup)",
            "Web Basics — Build a single static webpage (HTML + CSS)",
            "Cyber Hygiene — Read about strong passwords & MFA",
            "Command Line — Learn cd, ls, mkdir",
            "Debug Mind — Debug a small HTML/CSS layout issue",
            "Network Basics — Watch intro to IP addresses & ports",
            "Reflection — Write week wins + 1 improvement",
            "Solve 1 easy algorithm (warmup)",
            "Add a header and footer to your webpage",
            "Read about basic privacy settings (browser)",
            "Practice cat, less, head on files",
            "Fix one broken link or image path in project",
            "Learn what a subnet is (overview)",
            "Reflect + gratitude entry",
            "Solve another warmup algorithm",
            "Style page with basic CSS (colors/fonts)",
            "Set up a password manager conceptually (research)",
            "Use touch and edit a small file with nano/vi",
            "Reformat a CSS rule that's messy",
            "Learn about ports (common ports like 80, 443, 22)",
            "Weekly reflection + plan next week",
            "Algorithm warmup (focus on conditions)",
            "Make a simple navigation menu (links)",
            "Read one short article on phishing signs",
            "Practice copying files (cp) and moving (mv)",
            "Repair layout across small screens (mobile fix)",
            "Try ping to a site and note response times",
            "Reflect: what helped your focus most this week",
            "Warmup algorithm (loops)",
            "Add an image gallery / responsive img tags",
            "Summary reading: password hashing basics"
        ],
        questions: [
            "What was the most valuable thing you learned today?",
            "What felt challenging and why?",
            "How will you apply this tomorrow?",
            "One win from today:",
            "One area to improve:"
        ]
    },
    february: {
        title: "February — Security Awareness",
        days: 28,
        tasks: [
            "Cyber Hygiene — Explore phishing email identification techniques",
            "Network Basics — Learn the basics of DNS resolution",
            "Command Line — Practice navigating directories with cd and pwd",
            "Web — Create a simple HTML form for user input",
            "Debug Mind — Fix a syntax error in a basic script",
            "Logic — Solve a problem involving simple conditionals",
            "Reflection — Note one security habit you’ll start",
            "Cyber Hygiene — Research browser security extensions",
            "Network — Understand the role of firewalls",
            "Command Line — Use ls -l to view file permissions",
            "Web — Add CSS styling to your form",
            "Debug Mind — Trace a logical error in code",
            "Logic — Practice a loop-based problem",
            "Reflection — What security topic intrigued you?",
            "Cyber Hygiene — Learn about secure Wi-Fi practices",
            "Network — Study the concept of IP subnets",
            "Command Line — Experiment with the cat command",
            "Web — Implement a basic JavaScript validation",
            "Debug Mind — Resolve a CSS positioning issue",
            "Logic — Tackle a small sorting challenge",
            "Reflection — One security tool to explore further",
            "Cyber Hygiene — Read about two-factor authentication setup",
            "Network — Learn about common network ports",
            "Command Line — Practice creating directories with mkdir",
            "Web — Add a footer with contact info",
            "Debug Mind — Fix a broken image load",
            "Logic — Solve a problem with arrays",
            "Reflection — How did focus improve this week?"
        ],
        questions: [
            "What security tip stood out today?",
            "How did you notice a potential threat?",
            "What security practice will you adopt?",
            "One awareness gain:",
            "One question about security:"
        ]
    },
    march: {
        title: "March — Building Strength in Code",
        days: 31,
        tasks: [
            "Logic — Write a function to calculate averages",
            "Web — Build a multi-section webpage",
            "Debug Mind — Debug a loop in your code",
            "Network — Learn about TCP handshake process",
            "Command Line — Use find to locate files",
            "Cyber Hygiene — Study encryption basics",
            "Reflection — Note one coding strength",
            "Logic — Solve a problem with nested loops",
            "Web — Add a responsive navigation bar",
            "Debug Mind — Fix a variable scope issue",
            "Network — Explore NAT configuration basics",
            "Command Line — Practice using grep with patterns",
            "Cyber Hygiene — Read about SSL/TLS",
            "Web — Implement a CSS grid layout",
            "Reflection — What code skill improved?",
            "Logic — Create a function with parameters",
            "Debug Mind — Resolve a runtime error",
            "Network — Understand DNS query process",
            "Command Line — Use sort to organize data",
            "Cyber Hygiene — Learn about data privacy laws",
            "Web — Add interactive buttons with JS",
            "Reflection — One project idea from today",
            "Logic — Tackle a medium array problem",
            "Debug Mind — Optimize a slow function",
            "Network — Try a traceroute to a website",
            "Command Line — Archive files with tar",
            "Cyber Hygiene — Explore secure file storage",
            "Web — Enhance mobile responsiveness",
            "Reflection — What felt most rewarding?",
            "Network — Intro to packet analysis tools",
            "Debug Mind — Refactor messy code"
        ],
        questions: [
            "What coding technique worked well today?",
            "How did debugging enhance your understanding?",
            "What project could use this skill?",
            "One coding win:",
            "One area to strengthen:"
        ]
    },
    april: {
        title: "April — Calm Mind, Sharp Logic",
        days: 30,
        tasks: [
            "Logic — Design a modular function structure",
            "Web — Add media queries for responsiveness",
            "Cyber Hygiene — Study social engineering tactics",
            "Command Line — Learn file ownership with chown",
            "Debug Mind — Fix a layout overflow issue",
            "Network — Run a ping test to multiple sites",
            "Reflection — Note a troubleshooting lesson",
            "Logic — Break down a complex problem",
            "Web — Create a hamburger menu",
            "Cyber Hygiene — Learn email spoofing prevention",
            "Command Line — Use diff for file comparison",
            "Debug Mind — Resolve a load timing bug",
            "Network — Map open ports on your device",
            "Reflection — One moment of calm today",
            "Logic — Build a basic calculator function",
            "Web — Improve text readability",
            "Cyber Hygiene — Explore cookie security",
            "Command Line — Monitor processes with ps",
            "Debug Mind — Add comments for clarity",
            "Network — Compare IPv4 and IPv6",
            "Reflection — Best debugging tool today?",
            "Logic — Practice recursion basics",
            "Web — Add a click event handler",
            "Cyber Hygiene — Learn device hardening steps",
            "Command Line — View scheduled tasks",
            "Debug Mind — Fix an edge case",
            "Network — Capture packets with Wireshark",
            "Reflection — How did you stay focused?",
            "Logic — Revisit a hard problem",
            "Web — Polish page aesthetics"
        ],
        questions: [
            "What kept your mind calm today?",
            "How did logic problems build confidence?",
            "What mental strategy helped most?",
            "One focus win:",
            "One logic area to explore:"
        ]
    },
    may: {
        title: "May — Systems & Commands",
        days: 31,
        tasks: [
            "Cyber Hygiene — Compare antivirus tools",
            "Command Line — Kill a process with kill",
            "Debug Mind — Optimize a function",
            "Network — Read about Nmap basics",
            "Reflection — One system skill gained",
            "Logic — Use loops for list processing",
            "Web — Apply Flexbox to a layout",
            "Cyber Hygiene — Learn patch management",
            "Command Line — Check disk space with df",
            "Debug Mind — Fix a memory leak",
            "Network — Explore Nmap scan types",
            "Reflection — Habit to carry forward",
            "Logic — Solve an array manipulation",
            "Web — Design a card-based layout",
            "Cyber Hygiene — Update software safely",
            "Command Line — Try ssh connection",
            "Debug Mind — Handle errors gracefully",
            "Network — Learn MAC address basics",
            "Reflection — What was automated mentally?",
            "Logic — Tackle a loop challenge",
            "Web — Add hover effects",
            "Cyber Hygiene — Secure file deletion",
            "Command Line — View log files",
            "Debug Mind — Fix cross-browser issue",
            "Network — Study port scanning ethics",
            "Reflection — Favorite command today?",
            "Logic — Transform text with code",
            "Web — Improve accessibility",
            "Cyber Hygiene — Plan local backups",
            "Command Line — Compress files with gzip",
            "Debug Mind — Organize code comments"
        ],
        questions: [
            "What system command felt useful?",
            "How did systems knowledge help today?",
            "What automation idea came up?",
            "One command mastered:",
            "One system topic to dive into:"
        ]
    },
    june: {
        title: "June — Network & Connection",
        days: 30,
        tasks: [
            "Network — Study IPv4 addressing",
            "Reflection — Clear network concept",
            "Logic — Parse a network string",
            "Web — Create an IP explanation page",
            "Cyber Hygiene — Secure Wi-Fi setup",
            "Command Line — Run ifconfig",
            "Debug Mind — Fix an address script",
            "Network — Test ping latency",
            "Reflection — Next network skill to try",
            "Logic — Parse IP-like data",
            "Web — Draw a LAN diagram",
            "Cyber Hygiene — Secure router admin",
            "Command Line — List open ports",
            "Debug Mind — Fix log timestamps",
            "Network — Learn subnet masks",
            "Reflection — Network week summary",
            "Logic — Build a routing table",
            "Web — Add network resource links",
            "Cyber Hygiene — Use guest networks",
            "Command Line — View active connections",
            "Debug Mind — Fix data format",
            "Network — Run traceroute",
            "Reflection — Most useful tool?",
            "Logic — Match DNS-like data",
            "Web — Write a DNS explainer",
            "Cyber Hygiene — Avoid public Wi-Fi risks",
            "Command Line — Check routing table",
            "Debug Mind — Format network logs",
            "Network — Capture a packet",
            "Reflection — July scanning goal"
        ],
        questions: [
            "What network idea became clearer?",
            "How did traffic analysis help?",
            "Which tool will you use next?",
            "One network win:",
            "One network mystery left:"
        ]
    },
    july: {
        title: "July — Investigation & Analysis",
        days: 31,
        tasks: [
            "Logic — Solve a binary search",
            "Web — Summarize Nmap basics",
            "Cyber Hygiene — Read a breach case",
            "Command Line — Study Nmap usage",
            "Debug Mind — Fix a scan script",
            "Network — Run a safe Nmap scan",
            "Reflection — One case study insight",
            "Logic — Filter data with code",
            "Web — Add Nmap safety notes",
            "Cyber Hygiene — Learn forensics",
            "Command Line — Try tcpdump",
            "Debug Mind — Extract log data",
            "Network — Interpret Nmap results",
            "Reflection — Favorite tool?",
            "Logic — Search with edge cases",
            "Web — Add a safety tutorial",
            "Cyber Hygiene — Study reporting",
            "Command Line — Analyze a file",
            "Debug Mind — Clarify script output",
            "Network — Learn capture filters",
            "Reflection — Forensic idea to explore",
            "Logic — Optimize a search",
            "Web — Summarize an incident",
            "Cyber Hygiene — Read about logs",
            "Command Line — Run Nmap in a lab",
            "Debug Mind — Format to CSV",
            "Network — Study packet headers",
            "Reflection — What analysis means",
            "Logic — Handle variable inputs",
            "Web — Polish investigation page",
            "Cyber Hygiene — Learn disclosure"
        ],
        questions: [
            "What investigation skill stood out?",
            "How did analysis deepen understanding?",
            "Which tool aided your insight?",
            "One analytical win:",
            "One skill to refine:"
        ]
    },
    august: {
        title: "August — Debug & Discipline",
        days: 31,
        tasks: [
            "Command Line — Review key shortcuts",
            "Debug Mind — Fix an old bug",
            "Network — Capture a Wireshark trace",
            "Reflection — Discipline improvement",
            "Logic — Optimize an algorithm",
            "Web — Refactor a page",
            "Cyber Hygiene — Harden a device",
            "Command Line — Script a helper",
            "Debug Mind — Fix formatting",
            "Network — Test ping reliability",
            "Reflection — Best routine?",
            "Logic — Time a medium problem",
            "Web — Enhance accessibility",
            "Cyber Hygiene — Secure configs",
            "Command Line — Automate a task",
            "Debug Mind — Organize code",
            "Network — Read a pcap file",
            "Reflection — Time-saving method?",
            "Logic — Handle edge cases",
            "Web — Optimize images",
            "Cyber Hygiene — Apply least privilege",
            "Command Line — Add error handling",
            "Debug Mind — Check for regressions",
            "Network — Learn segmentation",
            "Reflection — Small discipline win",
            "Logic — Solve under calm",
            "Web — Add troubleshooting notes",
            "Cyber Hygiene — Plan recovery",
            "Command Line — Test dry-run",
            "Debug Mind — Tidy comments",
            "Network — Label a pcap"
        ],
        questions: [
            "What debugging habit helped today?",
            "How did discipline aid your work?",
            "What systematic fix worked?",
            "One debug win:",
            "One habit to keep:"
        ]
    },
    september: {
        title: "September — Project Building",
        days: 30,
        tasks: [
            "Reflection — Plan a project idea",
            "Logic — Design function logic",
            "Web — Build a page skeleton",
            "Cyber Hygiene — Note security risks",
            "Command Line — Set up folders",
            "Debug Mind — Fix initial bugs",
            "Network — Plan network tests",
            "Reflection — Track progress",
            "Logic — Code a function",
            "Web — Add page styling",
            "Cyber Hygiene — Add validation",
            "Command Line — Init a git repo",
            "Debug Mind — Test errors",
            "Network — Test local endpoints",
            "Reflection — Key feature?",
            "Logic — Optimize a task",
            "Web — Make responsive",
            "Cyber Hygiene — Add checklist",
            "Command Line — Commit changes",
            "Debug Mind — Fix UI flow",
            "Network — Simulate delay",
            "Reflection — Next week plan",
            "Logic — Add manual tests",
            "Web — Polish visuals",
            "Cyber Hygiene — Check vulnerabilities",
            "Command Line — Prepare deployment",
            "Debug Mind — Run end-to-end test",
            "Network — Review dependencies",
            "Reflection — Demo plan",
            "Logic — Final tweaks"
        ],
        questions: [
            "What project step felt best?",
            "How did planning prevent issues?",
            "Which feature are you proud of?",
            "One project lesson:",
            "One improvement idea:"
        ]
    },
    october: {
        title: "October — Automation & Scripting",
        days: 31,
        tasks: [
            "Cyber Hygiene — Learn script security",
            "Command Line — Explore crontab",
            "Debug Mind — Fix script edges",
            "Network — Sketch a monitor script",
            "Reflection — Useful automation?",
            "Logic — Script an I/O tool",
            "Web — Build a status page",
            "Cyber Hygiene — Secure credentials",
            "Command Line — Schedule a task",
            "Debug Mind — Enhance logs",
            "Network — Automate ping logs",
            "Reflection — Time saved?",
            "Logic — Build a parser",
            "Web — Show parser results",
            "Cyber Hygiene — Avoid plain text",
            "Command Line — Test scheduling",
            "Debug Mind — Boost performance",
            "Network — Script connection stats",
            "Reflection — Best automation?",
            "Logic — Add CLI args",
            "Web — Format outputs",
            "Cyber Hygiene — Secure logging",
            "Command Line — Plan log rotation",
            "Debug Mind — Test inputs",
            "Network — Automate scan reports",
            "Reflection — Next automation?",
            "Logic — Add error handling",
            "Web — Add a script trigger",
            "Cyber Hygiene — Document security",
            "Command Line — Stop tasks safely",
            "Debug Mind — Finalize logs"
        ],
        questions: [
            "What task was automated today?",
            "How did scripting save time?",
            "What script idea excites you?",
            "One automation win:",
            "One scripting skill to learn:"
        ]
    },
    november: {
        title: "November — Review & Growth",
        days: 30,
        tasks: [
            "Network — Review past labs",
            "Reflection — Most productive month",
            "Logic — Retest January problems",
            "Web — Improve an old page",
            "Cyber Hygiene — Update security checklist",
            "Command Line — Refresh grep skills",
            "Debug Mind — Fix a lingering bug",
            "Network — Analyze old pcaps",
            "Reflection — December plan",
            "Logic — Solve a skipped problem",
            "Web — Optimize page speed",
            "Cyber Hygiene — Secure 2FA",
            "Command Line — Review logs",
            "Debug Mind — Patch old project",
            "Network — Compare scan notes",
            "Reflection — Habits to keep",
            "Logic — Retry a hard problem",
            "Web — Update portfolio",
            "Cyber Hygiene — Plan backups",
            "Command Line — Make a cheat sheet",
            "Debug Mind — Clean repo",
            "Network — Check network health",
            "Reflection — Year surprise",
            "Logic — Time small challenges",
            "Web — Prep portfolio docs",
            "Cyber Hygiene — Make recovery list",
            "Command Line — Automate maintenance",
            "Debug Mind — Clean notes",
            "Network — Summarize learning",
            "Reflection — November takeaways"
        ],
        questions: [
            "What skill grew most this year?",
            "How has your approach evolved?",
            "What habit will you continue?",
            "One growth milestone:",
            "One area to grow next year:"
        ]
    },
    december: {
        title: "December — Mastery & Calm",
        days: 31,
        tasks: [
            "Logic — Light warmup exercise",
            "Web — Review a favorite project",
            "Cyber Hygiene — Check security status",
            "Command Line — Practice core commands",
            "Debug Mind — Polish a bug fix",
            "Network — Review Wireshark notes",
            "Reflection — Write year story",
            "Logic — Maintain coding rhythm",
            "Web — Refine portfolio text",
            "Cyber Hygiene — Plan next year’s security",
            "Command Line — Organize configs",
            "Debug Mind — Finalize docs",
            "Network — Summarize concepts",
            "Reflection — Celebrate progress",
            "Logic — Optional light practice",
            "Web — Create a year recap page",
            "Cyber Hygiene — Verify backups",
            "Command Line — Backup safely",
            "Debug Mind — Archive old work",
            "Network — Draw a network flow",
            "Reflection — Top 3 lessons",
            "Logic — Rest or review",
            "Web — Visualize progress",
            "Cyber Hygiene — Clean accounts",
            "Command Line — Practice shutdown",
            "Debug Mind — Reflect on code",
            "Network — Review favorite tools",
            "Reflection — Set 2 goals",
            "Logic — Very light practice",
            "Web — Finalize portfolio",
            "Cyber Hygiene — End with security note"
        ],
        questions: [
            "What are you proudest of this year?",
            "How has this journey shaped you?",
            "What will you celebrate?",
            "One key lesson:",
            "One goal for next year:"
        ]
    }
};

class RoadmapTracker {
    constructor() {
        this.currentMonth = this.getCurrentMonth();
        this.progress = JSON.parse(localStorage.getItem('roadmapProgress')) || {};
        this.reflections = JSON.parse(localStorage.getItem('roadmapReflections')) || {};
        this.currentTheme = localStorage.getItem('theme') || 'light';
        this.isLoading = false;
        this.activeDropdown = null;
        this.openedReflection = null;
    }

    getCurrentMonth() {
        const now = new Date();
        const monthNames = ['january', 'february', 'march', 'april', 'may', 'june', 
                           'july', 'august', 'september', 'october', 'november', 'december'];
        return monthNames[now.getMonth()];
    }

    init() {
        try {
            this.renderMonthNav();
            this.renderCurrentMonth();
            this.updateOverallProgress();
            this.bindEvents();
            this.setTheme(this.currentTheme);
            this.highlightToday();
            document.querySelector('.container').classList.add('loaded');
            this.showNotification('Welcome to your Cybersecurity Journey!');
        } catch (error) {
            console.error('Initialization failed:', error);
            this.showErrorMessage();
        }
    }

    showErrorMessage() {
        const errorDiv = document.getElementById('errorMessage');
        errorDiv.style.display = 'block';
        errorDiv.textContent = 'Failed to load content. Please try refreshing the page.';
        this.showNotification('Error loading content. Please refresh.');
    }

    renderMonthNav() {
        try {
            const nav = document.querySelector('.month-nav');
            nav.innerHTML = '';
            Object.keys(ROADMAP_DATA).forEach(month => {
                const btn = document.createElement('button');
                btn.className = `nav-btn neumorphic ${month === this.currentMonth ? 'active' : ''}`;
                btn.dataset.month = month;
                btn.textContent = month.charAt(0).toUpperCase() + month.slice(1, 3);
                btn.setAttribute('aria-label', `View ${month} tasks`);
                nav.appendChild(btn);
            });
        } catch (error) {
            console.error('Render month nav failed:', error);
            this.showErrorMessage();
        }
    }

    async renderCurrentMonth() {
        if (this.isLoading) return;
        this.isLoading = true;
        const errorDiv = document.getElementById('errorMessage');
        errorDiv.style.display = 'none';

        try {
            const monthData = ROADMAP_DATA[this.currentMonth];
            if (!monthData) {
                throw new Error(`No data found for month: ${this.currentMonth}`);
            }

            const monthTitle = document.getElementById('monthTitle');
            const daysGrid = document.getElementById('daysGrid');
            
            monthTitle.textContent = monthData.title;
            
            const monthProgress = this.getMonthProgress(this.currentMonth);
            document.getElementById('daysCompleted').textContent = `${monthProgress.completed}/${monthData.days}`;
            document.getElementById('monthProgress').textContent = `${monthProgress.percentage}%`;
            
            daysGrid.innerHTML = '';
            monthData.tasks.forEach((task, index) => {
                const dayNum = index + 1;
                const completed = this.isDayCompleted(this.currentMonth, dayNum);
                const dayElement = this.createDayElement(dayNum, task, completed);
                daysGrid.appendChild(dayElement);
                setTimeout(() => dayElement.classList.add('loaded'), 50 * index);
            });

            await new Promise(resolve => setTimeout(resolve, 300));
            this.highlightToday();
        } catch (error) {
            console.error('Render month failed:', error);
            this.showErrorMessage();
        } finally {
            this.isLoading = false;
        }
    }

    createDayElement(dayNum, task, completed) {
        try {
            const dayDiv = document.createElement('div');
            dayDiv.className = `day-card neumorphic ${completed ? 'completed' : ''}`;
            dayDiv.dataset.month = this.currentMonth;
            dayDiv.dataset.day = dayNum;
            dayDiv.setAttribute('aria-label', `Day ${dayNum}: ${task}`);

            dayDiv.innerHTML = `
                <div class="day-header">
                    <span class="day-number">Day ${dayNum}</span>
                    <div class="completion-toggle ${completed ? 'checked' : ''}" 
                         data-month="${this.currentMonth}" 
                         data-day="${dayNum}" 
                         role="checkbox" 
                         aria-checked="${completed}" 
                         tabindex="0"></div>
                </div>
                <div class="task-description">${task}</div>
            `;

            const toggle = dayDiv.querySelector('.completion-toggle');
            toggle.addEventListener('click', (e) => {
                e.stopPropagation();
                this.toggleDayCompletion(this.currentMonth, dayNum);
            });
            toggle.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    this.toggleDayCompletion(this.currentMonth, dayNum);
                }
            });

            dayDiv.addEventListener('click', (e) => {
                if (!e.target.classList.contains('completion-toggle')) {
                    this.openReflectionModal(this.currentMonth, dayNum);
                }
            });

            return dayDiv;
        } catch (error) {
            console.error('Create day element failed:', error);
            this.showNotification('Failed to render day card.');
            return document.createElement('div');
        }
    }

    async toggleDayCompletion(month, day) {
        try {
            if (!this.progress[month]) this.progress[month] = {};
            this.progress[month][day] = !this.progress[month][day];
            this.saveProgress();
            await this.renderCurrentMonth();
            this.updateOverallProgress();
            this.showNotification(`Day ${day} marked as ${this.progress[month][day] ? 'completed' : 'incomplete'}.`);
        } catch (error) {
            console.error('Toggle completion failed:', error);
            this.showNotification('Failed to update progress.');
        }
    }

    isDayCompleted(month, day) {
        return this.progress[month] && this.progress[month][day] === true;
    }

    getMonthProgress(month) {
        try {
            const monthData = ROADMAP_DATA[month];
            if (!monthData) return { completed: 0, total: 0, percentage: 0 };
            
            let completed = 0;
            if (this.progress[month]) {
                completed = Object.values(this.progress[month]).filter(Boolean).length;
            }
            const percentage = Math.round((completed / monthData.days) * 100);
            return { completed, total: monthData.days, percentage };
        } catch (error) {
            console.error('Get month progress failed:', error);
            return { completed: 0, total: 0, percentage: 0 };
        }
    }

    updateOverallProgress() {
        try {
            let totalCompleted = 0;
            let totalDays = 0;

            Object.keys(ROADMAP_DATA).forEach(month => {
                const progress = this.getMonthProgress(month);
                totalCompleted += progress.completed;
                totalDays += progress.total;
            });

            const percentage = totalDays > 0 ? Math.round((totalCompleted / totalDays) * 100) : 0;
            const progressFill = document.getElementById('overallProgress');
            const progressText = document.getElementById('progressText');
            
            progressText.textContent = `${percentage}%`;
            progressFill.style.width = `${percentage}%`;
        } catch (error) {
            console.error('Update progress failed:', error);
            this.showNotification('Failed to update progress bar.');
        }
    }

    openReflectionModal(month, day) {
        try {
            const monthData = ROADMAP_DATA[month];
            const task = monthData.tasks[day - 1];
            const questions = monthData.questions || [
                "What did you learn today?",
                "What will you practice tomorrow?",
                "One key takeaway:",
                "One challenge faced:"
            ];

            document.getElementById('modalDayTitle').textContent = `${monthData.title} - Day ${day}`;
            document.getElementById('dailyQuestions').innerHTML = questions.map(q => 
                `<div class="question-item">${q}</div>`
            ).join('');
            
            this.openedReflection = { month, day };
            const existingNotes = this.reflections[month]?.[day] || '';
            document.getElementById('dailyNotes').value = existingNotes;
            
            const modal = document.getElementById('reflectionModal');
            modal.style.display = 'flex';
            setTimeout(() => {
                modal.querySelector('.modal-content').classList.add('neumorphic');
                modal.querySelector('.modal-content').focus();
            }, 50);
        } catch (error) {
            console.error('Open modal failed:', error);
            this.showNotification('Failed to open reflection modal.');
        }
    }

    closeReflectionModal() {
        try {
            const modal = document.getElementById('reflectionModal');
            modal.style.display = 'none';
            modal.querySelector('.modal-content').classList.remove('neumorphic');
            this.openedReflection = null;
            document.getElementById('dailyNotes').value = '';
        } catch (error) {
            console.error('Close modal failed:', error);
            this.showNotification('Failed to close reflection modal.');
        }
    }

    saveReflection() {
        try {
            const { month, day } = this.openedReflection || {};
            if (!month || !day) return;
            
            const notes = document.getElementById('dailyNotes').value;
            if (!this.reflections[month]) this.reflections[month] = {};
            this.reflections[month][day] = notes;
            localStorage.setItem('roadmapReflections', JSON.stringify(this.reflections));
            this.closeReflectionModal();
            this.showNotification('Reflection saved successfully.');
        } catch (error) {
            console.error('Save reflection failed:', error);
            this.showNotification('Failed to save reflection.');
        }
    }

    saveProgress() {
        try {
            localStorage.setItem('roadmapProgress', JSON.stringify(this.progress));
        } catch (error) {
            console.error('Save progress failed:', error);
            this.showNotification('Failed to save progress.');
        }
    }

    highlightToday() {
        try {
            const today = new Date();
            const currentMonthIndex = Object.keys(ROADMAP_DATA).indexOf(this.currentMonth);
            const isCurrentMonth = currentMonthIndex === today.getMonth();
            if (isCurrentMonth) {
                const todayElement = document.querySelector(`.day-card[data-day="${today.getDate()}"]`);
                if (todayElement) {
                    todayElement.classList.add('today');
                    todayElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
        } catch (error) {
            console.error('Highlight today failed:', error);
            this.showNotification('Failed to highlight today.');
        }
    }

    importProgress(event) {
        try {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const imported = JSON.parse(e.target.result);
                    this.progress = imported;
                    this.saveProgress();
                    this.renderCurrentMonth();
                    this.updateOverallProgress();
                    this.showNotification('Progress imported successfully.');
                } catch (error) {
                    console.error('Import progress failed:', error);
                    this.showNotification('Failed to import progress. Invalid file format.');
                }
            };
            reader.readAsText(file);
        } catch (error) {
            console.error('Import progress setup failed:', error);
            this.showNotification('Error during import.');
        }
    }

    exportProgress() {
        try {
            const data = JSON.stringify(this.progress, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'cybersecurity_progress.json';
            a.click();
            URL.revokeObjectURL(url);
            this.showNotification('Progress exported successfully.');
        } catch (error) {
            console.error('Export progress failed:', error);
            this.showNotification('Failed to export progress.');
        }
    }

    resetProgress() {
        try {
            if (confirm('Are you sure you want to reset all progress? This cannot be undone.')) {
                this.progress = {};
                this.reflections = {};
                localStorage.removeItem('roadmapProgress');
                localStorage.removeItem('roadmapReflections');
                this.renderCurrentMonth();
                this.updateOverallProgress();
                this.showNotification('Progress reset successfully.');
            }
        } catch (error) {
            console.error('Reset progress failed:', error);
            this.showNotification('Failed to reset progress.');
        }
    }

    setTheme(theme) {
        try {
            document.body.className = theme;
            localStorage.setItem('theme', theme);
            this.currentTheme = theme;

            const themeOptions = document.querySelectorAll('.theme-option');
            themeOptions.forEach(option => {
                option.classList.toggle('active', option.dataset.theme === theme);
            });

            const themeToggle = document.getElementById('themeToggle');
            themeToggle.setAttribute('aria-pressed', 'true');

            if (this.activeDropdown) {
                this.toggleThemeDropdown(false);
            }
        } catch (error) {
            console.error('Set theme failed:', error);
            this.showNotification('Failed to apply theme.');
        }
    }

    toggleThemeDropdown(forceOpen = null) {
        try {
            const dropdown = document.getElementById('themeDropdown');
            const toggle = document.getElementById('themeToggle');
            const isOpen = forceOpen !== null ? forceOpen : !dropdown.classList.contains('active');

            if (!isOpen) {
                dropdown.classList.remove('active');
                dropdown.style.display = 'none';
                toggle.classList.remove('active');
                toggle.setAttribute('aria-pressed', 'false');
                this.activeDropdown = null;
            } else {
                dropdown.style.display = 'flex';
                setTimeout(() => dropdown.classList.add('active'), 10);
                toggle.classList.add('active');
                toggle.setAttribute('aria-pressed', 'true');
                this.activeDropdown = dropdown;
            }
        } catch (error) {
            console.error('Toggle theme dropdown failed:', error);
            this.showNotification('Failed to toggle theme dropdown.');
        }
    }

    showNotification(message) {
        try {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: rgba(16, 185, 129, 0.9);
                color: #ffffff;
                padding: 12px 24px;
                border-radius: 12px;
                box-shadow: 4px 4px 8px rgba(0, 0, 0, 0.15), -4px -4px 8px rgba(255, 255, 255, 0.15);
                opacity: 0;
                transition: opacity 0.3s ease;
                z-index: 2000;
            `;
            document.body.appendChild(notification);
            setTimeout(() => {
                notification.style.opacity = '1';
            }, 10);
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        } catch (error) {
            console.error('Show notification failed:', error);
        }
    }

    bindEvents() {
        try {
            // Month navigation
            document.querySelector('.month-nav').addEventListener('click', (e) => {
                const btn = e.target.closest('.nav-btn');
                if (btn) {
                    this.currentMonth = btn.dataset.month;
                    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    this.renderCurrentMonth();
                }
            });

            // Theme toggle
            const themeToggle = document.getElementById('themeToggle');
            themeToggle.addEventListener('click', () => {
                this.toggleThemeDropdown();
            });
            themeToggle.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    this.toggleThemeDropdown();
                }
            });

            // Theme options
            document.querySelectorAll('.theme-option').forEach(option => {
                option.addEventListener('click', () => {
                    this.setTheme(option.dataset.theme);
                });
                option.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        this.setTheme(option.dataset.theme);
                    }
                });
            });

            // Close dropdown on outside click
            document.addEventListener('click', (e) => {
                if (this.activeDropdown && !e.target.closest('.theme-toggle-wrapper')) {
                    this.toggleThemeDropdown(false);
                }
            });

            // Modal controls
            document.getElementById('closeModal').addEventListener('click', () => {
                this.closeReflectionModal();
            });

            document.getElementById('cancelReflection').addEventListener('click', () => {
                this.closeReflectionModal();
            });

            document.getElementById('saveReflection').addEventListener('click', () => {
                this.saveReflection();
            });

            document.getElementById('reflectionModal').addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    this.closeReflectionModal();
                }
            });

            // Progress controls
            document.getElementById('triggerImport').addEventListener('click', () => {
                document.getElementById('importProgress').click();
            });

            document.getElementById('importProgress').addEventListener('change', (e) => {
                this.importProgress(e);
            });

            document.getElementById('exportProgress').addEventListener('click', () => {
                this.exportProgress();
            });

            document.getElementById('resetProgress').addEventListener('click', () => {
                this.resetProgress();
            });

            // Tab switching (Tasks/Resources)
            document.querySelectorAll('.nav-btn[data-tab]').forEach(btn => {
                btn.addEventListener('click', () => {
                    const tab = btn.dataset.tab;
                    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                    document.getElementById(`${tab}Tab`).classList.add('active');
                    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                });
            });

            // Resources (basic implementation - expand as needed)
            document.getElementById('saveResource').addEventListener('click', () => {
                const url = document.getElementById('resourceUrl').value;
                const notes = document.getElementById('resourceNotes').value;
                if (url && notes) {
                    const saved = JSON.parse(localStorage.getItem('savedResources') || '[]');
                    saved.push({ url, notes, date: new Date().toISOString() });
                    localStorage.setItem('savedResources', JSON.stringify(saved));
                    this.renderSavedResources();
                    this.showNotification('Resource saved!');
                    document.getElementById('resourceUrl').value = '';
                    document.getElementById('resourceNotes').value = '';
                }
            });

            this.renderSavedResources();
            document.getElementById('currentMonthName').textContent = this.currentMonth.charAt(0).toUpperCase() + this.currentMonth.slice(1);
        } catch (error) {
            console.error('Bind events failed:', error);
            this.showNotification('Failed to initialize event listeners.');
        }
    }

    renderSavedResources() {
        const saved = JSON.parse(localStorage.getItem('savedResources') || '[]');
        const list = document.getElementById('savedResourcesList');
        list.innerHTML = saved.map(item => `
            <li class="neumorphic">
                <a href="${item.url}" target="_blank">${item.url}</a>
                <div class="resource-meta">Added: ${new Date(item.date).toLocaleDateString()}</div>
                <div class="resource-notes">${item.notes}</div>
            </li>
        `).join('');
    }
}

document.addEventListener('DOMContentLoaded', () => {
    const tracker = new RoadmapTracker();
    tracker.init();
});